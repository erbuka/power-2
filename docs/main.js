!function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e,i){t.exports=i.p+"ef0ec5c01566a985e62e1f82b71610ae.mp3"},function(t,e,i){i(7),t.exports=i(6)},function(t,e,i){var n=i(3);"string"==typeof n&&(n=[[t.i,n,""]]);var s={insert:"head",singleton:!1};i(5)(n,s);n.locals&&(t.exports=n.locals)},function(t,e,i){(t.exports=i(4)(!1)).push([t.i,"body,\r\nhtml {\r\n  margin: 0;\r\n  padding: 0;\r\n  height: 100%;\r\n}\r\n \r\ncanvas {\r\n  display: block;\r\n}",""])},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var s=(a=n,o=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),h="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(o),"/*# ".concat(h," */")),r=n.sources.map((function(t){return"/*# sourceURL=".concat(n.sourceRoot).concat(t," */")}));return[i].concat(r).concat([s]).join("\n")}var a,o,h;return[i].join("\n")}(e,t);return e[2]?"@media ".concat(e[2],"{").concat(i,"}"):i})).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},s=0;s<this.length;s++){var r=this[s][0];null!=r&&(n[r]=!0)}for(var a=0;a<t.length;a++){var o=t[a];null!=o[0]&&n[o[0]]||(i&&!o[2]?o[2]=i:i&&(o[2]="(".concat(o[2],") and (").concat(i,")")),e.push(o))}},e}},function(t,e,i){"use strict";var n,s={},r=function(){return void 0===n&&(n=Boolean(window&&document&&document.all&&!window.atob)),n},a=function(){var t={};return function(e){if(void 0===t[e]){var i=document.querySelector(e);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}t[e]=i}return t[e]}}();function o(t,e){for(var i=[],n={},s=0;s<t.length;s++){var r=t[s],a=e.base?r[0]+e.base:r[0],o={css:r[1],media:r[2],sourceMap:r[3]};n[a]?n[a].parts.push(o):i.push(n[a]={id:a,parts:[o]})}return i}function h(t,e){for(var i=0;i<t.length;i++){var n=t[i],r=s[n.id],a=0;if(r){for(r.refs++;a<r.parts.length;a++)r.parts[a](n.parts[a]);for(;a<n.parts.length;a++)r.parts.push(g(n.parts[a],e))}else{for(var o=[];a<n.parts.length;a++)o.push(g(n.parts[a],e));s[n.id]={id:n.id,refs:1,parts:o}}}}function l(t){var e=document.createElement("style");if(void 0===t.attributes.nonce){var n=i.nc;n&&(t.attributes.nonce=n)}if(Object.keys(t.attributes).forEach((function(i){e.setAttribute(i,t.attributes[i])})),"function"==typeof t.insert)t.insert(e);else{var s=a(t.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(e)}return e}var u,c=(u=[],function(t,e){return u[t]=e,u.filter(Boolean).join("\n")});function f(t,e,i,n){var s=i?"":n.css;if(t.styleSheet)t.styleSheet.cssText=c(e,s);else{var r=document.createTextNode(s),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}function d(t,e,i){var n=i.css,s=i.media,r=i.sourceMap;if(s&&t.setAttribute("media",s),r&&btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var m=null,p=0;function g(t,e){var i,n,s;if(e.singleton){var r=p++;i=m||(m=l(e)),n=f.bind(null,i,r,!1),s=f.bind(null,i,r,!0)}else i=l(e),n=d.bind(null,i,e),s=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(i)};return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else s()}}t.exports=function(t,e){(e=e||{}).attributes="object"==typeof e.attributes?e.attributes:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=r());var i=o(t,e);return h(i,e),function(t){for(var n=[],r=0;r<i.length;r++){var a=i[r],l=s[a.id];l&&(l.refs--,n.push(l))}t&&h(o(t,e),e);for(var u=0;u<n.length;u++){var c=n[u];if(0===c.refs){for(var f=0;f<c.parts.length;f++)c.parts[f]();delete s[c.id]}}}}},function(t,e){Math.randomRange=function(t,e){return t+Math.random()*(e-t)},Array.prototype.fish=function(){if(0==this.length)return null;let t=Math.floor(Math.randomRange(0,this.length)),e=this[t];return this.splice(t,1),e},Array.prototype.random=function(){if(0==this.length)return null;return this[Math.floor(Math.randomRange(0,this.length))]},Array.iota=function(t,e){let i=(e-t)/Math.abs(e-t),n=[];for(let s=t;s!==e+i;s+=i)n.push(s);return n},Array.prototype.shuffle=function(){let t=Array.iota(0,this.length-1),e=[];for(;t.length>0;){let i=t.fish();e.push(this[i])}return e}},function(t,e,i){"use strict";i.r(e);class n{constructor(t){this.size=t,this.count=t*t,this.data=new Array(t*t);for(let e=0;e<t*t;e++)this.data[e]=-1}init(){let t=this.count,e=Array.iota(0,t-1);for(let t=0;t<this.size/2;t++){let t=e.fish();this.data[t]=1}this.computeNext()}computeNext(){let t=Math.random();for(let e=this.getHighestPower();e>=1;e--)if(t<Math.pow(1/e,3))return void(this.next=e);throw"This shouldn't be thrown"}clone(){let t=new n(this.size);return t.data=this.data.map(t=>t),t}randomFreeSpot(){return this.data.map((t,e)=>[t,e]).filter(t=>-1===t[0]).fish()[1]}get(t,e){return t<0||t>=this.size||e<0||e>=this.size?null:this.data[e*this.size+t]}set(t,e,i){this.data[e*this.size+t]=i}getScore(t){let e=0;for(let t of this.data)t>1&&(e+=Math.pow(3,t-1));return e}canMove(){if(this.data.find(t=>-1==t))return!0;for(let t=0;t<this.size;t++)for(let e=0;e<this.size;e++){let i=this.get(t,e);if(i===this.get(t+1,e)||i===this.get(t,e+1))return!0}return!1}move(t){let e=[],i="left"===t||"up"===t,n="left"===t||"right"===t,s=this.clone(),r=i?Array.iota(0,this.size-2):Array.iota(this.size-1,1),a=i?1:-1;for(let t of r)for(let i=0;i<this.size;i++){let r=n?t:i,o=n?i:t,h=n?r+a:r,l=n?o:o+a,u=s.get(r,o),c=s.get(h,l);-1===u?(s.set(r,o,c),s.set(h,l,-1),-1!==c&&e.push([r,o,h,l])):u===c&&(s.set(r,o,u+1),s.set(h,l,-1),e.push([r,o,h,l]))}return e.length>0&&(s.data[s.randomFreeSpot()]=this.next),s.computeNext(),{moves:e,state:s}}getHighestPower(){let t=-1;return this.data.forEach(e=>t=Math.max(t,e)),t}}var s=i(0),r=i.n(s);const a={Loading:0,Playing:1,MainMenu:2,Score:3},o={GameTitle:"Power 2",NewGame:"Press ENTER to Start"};class h{constructor(){this.colors=[],this.animatedSquares=[],this.highScore=parseInt(localStorage.getItem("highscore"))||0;for(let t=0;t<1440;t+=75)this.colors.push(`hsl(${t%360}, 50%, 50%)`)}start(){this.state=a.MainMenu,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),window.addEventListener("resize",this.resize.bind(this)),window.addEventListener("keyup",this.keyup.bind(this)),document.body.appendChild(this.canvas),this.resize(),this.startTime=this.prevTime=Date.now(),window.requestAnimationFrame(this.update.bind(this))}keyup(t){if(this.state===a.MainMenu&&13==t.keyCode&&this.newGame(),this.state===a.Score&&13==t.keyCode&&(this.state=a.MainMenu),this.state===a.Playing){if(this.animatedSquares.length>0)return;let e=null;switch(t.keyCode){case 37:e=this.game.move("left");break;case 39:e=this.game.move("right");break;case 38:e=this.game.move("up");break;case 40:e=this.game.move("down")}e&&e.moves.length>0&&(this.nextGame=e.state,this.animatedSquares.push(...e.moves.map(t=>({type:"move",value:this.nextGame.get(t[0],t[1]),fromX:t[2],fromY:t[3],toX:t[0],toY:t[1],delta:0,speed:10}))),new Audio(r.a).play(),this.nextGame.canMove()||(this.currentGameScore=this.nextGame.getScore(),this.highScore=Math.max(this.highScore,this.currentGameScore),localStorage.setItem("highscore",this.highScore),this.state=a.Score))}}resize(){this.width=this.canvas.width=window.innerWidth,this.height=this.canvas.height=window.innerHeight,this.fontSize={normal:Math.round(this.height/20),big:Math.round(this.height/5)}}drawCenteredText(t,e,i,n){let s=this.ctx,r=s.measureText(t);i&&s.fillText(t,(this.width-r.width)/2,e),n&&s.strokeText(t,(this.width-r.width)/2,e)}update(){window.requestAnimationFrame(this.update.bind(this));let t=Date.now(),e=(t-this.prevTime)/1e3,i=(t-this.startTime)/1e3;this.prevTime=t;let n=this.canvas,s=n.width,r=n.height,h=this.ctx,l=this.fontSize.big,u=this.fontSize.normal;if(h.fillStyle="#F6F9EC",h.fillRect(0,0,s,r),this.state===a.Playing&&this.drawGame(e),this.state===a.MainMenu&&(h.save(),this.setFont(l),this.setShadow(),h.fillStyle="#fff",this.drawCenteredText(o.GameTitle,this.height/3,!0),h.restore(),h.save(),this.setFont(u),this.setShadow(),h.fillStyle=`rgba(255,255,255,${(Math.sin(10*i)+1)/2}`,this.drawCenteredText(o.NewGame,this.height/1.5,!0),h.fillStyle="#fff",this.drawCenteredText(`Highscore: ${this.highScore}`,this.height/1.5+1.5*u,!0),h.restore()),this.state===a.Score){let t=(this.height+l)/2;h.save(),this.setShadow(),h.fillStyle="#fff",this.setFont(l),this.drawCenteredText("Game Over!",t,!0),this.setFont(u),this.drawCenteredText(`Your score is ${this.currentGameScore}`,t+1.5*u,!0),h.restore()}}setFont(t){this.ctx.font=`700 ${t}px Kanit`}setShadow(){let t=this.ctx;t.shadowOffsetX=1,t.shadowOffsetY=1,t.shadowBlur=4,t.shadowColor="rgba(0,0,0,0.25)"}roundedRect(t,e,i,n,s){let r=this.ctx;r.beginPath(),r.moveTo(t,e+s),r.lineTo(t,e+n-s),r.arcTo(t,e+n,t+s,e+n,s),r.lineTo(t+i-s,e+n),r.arcTo(t+i,e+n,t+i,e+n-s,s),r.lineTo(t+i,e+s),r.arcTo(t+i,e,t+i-s,e,s),r.lineTo(t+s,e),r.arcTo(t,e,t,e+s,s)}drawGame(t){let e=this.width,i=this.height,n=this.game,s=this.ctx,r=this.height/(1.25*this.game.size),a=r/10,o=r/10,h=Math.round(r/4),l=r*n.size+a*(n.size+1),u=t=>-l/2+t*r+(t+1)*a,c=t=>-l/2+t*r+(t+1)*a,f=(t,e,i)=>{if(-1!==i){let n=Math.pow(2,i),a=s.measureText(n),l=this.colors[i%this.colors.length];s.save(),s.translate(t+r/2,e+r/2),this.setShadow(),s.fillStyle=l,this.roundedRect(-r/2,-r/2,r,r,o),s.fill(),s.fillStyle="#fff",s.fillText(n,-a.width/2,h/2),s.restore()}};this.setFont(h),s.save(),s.translate(e/2,i/2),s.save(),this.setShadow(),s.fillStyle="#d3e59e",this.roundedRect(-l/2,-l/2,l,l,o),s.fill(),s.restore();for(let t=0;t<n.size;t++)for(let e=0;e<n.size;e++){if(s.fillStyle="rgba(255,255,255,0.5)",this.roundedRect(u(t),c(e),r,r,o),s.fill(),this.nextGame&&this.animatedSquares.find(i=>i.fromX===t&&i.fromY===e))continue;let i=n.get(t,e);f(u(t),c(e),i)}if(this.nextGame){for(let e of this.animatedSquares){if("move"===e.type){f(u(e.fromX)*(1-e.delta)+u(e.toX)*e.delta,c(e.fromY)*(1-e.delta)+c(e.toY)*e.delta,e.value)}e.delta=Math.min(1,e.delta+e.speed*t)}this.animatedSquares=this.animatedSquares.filter(t=>t.delta<1),0===this.animatedSquares.length&&(this.game=this.nextGame,this.nextGame=null)}s.restore(),s.save();{let t=this.fontSize.normal;this.setShadow(),this.setFont(t),s.fillStyle="#fff",s.fillText("Score",this.height/10,this.height/10),s.fillStyle=this.colors[this.game.getHighestPower()%this.colors.length],s.fillText(this.game.getScore(),this.height/10,this.height/10+1.25*t),s.fillStyle="#fff",s.fillText("Next",this.height/10,this.height/10+3.75*t),f(this.height/10,this.height/10+4.5*t,this.game.next)}}newGame(){this.animatedSquares=[],this.nextGame=null,this.game=new n(4),this.game.init(),this.state=a.Playing}}i(2);window.addEventListener("load",(function(){let t=new h;t.start(),window.app=t}))}]);